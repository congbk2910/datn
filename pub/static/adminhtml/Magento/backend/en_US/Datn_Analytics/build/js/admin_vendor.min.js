define([
    'jquery',
    'bootstrap',
    'moment'
],function($, bootstrap, moment){
    'use strict';

    return function (config) {
        function init_flot_chart(){
            if( typeof ($.plot) === 'undefined'){ return; }

            var chart_plot_data = config.chartPlotData;
            var max_xaxis = config.chartPlotData.length;

            var chart_plot_settings = {
                grid: {
                    show: true,
                    aboveData: true,
                    color: "#3f3f3f",
                    labelMargin: 10,
                    axisMargin: 0,
                    borderWidth: 0,
                    borderColor: null,
                    minBorderMargin: 5,
                    clickable: true,
                    hoverable: true,
                    autoHighlight: true,
                    mouseActiveRadius: 100
                },
                series: {
                    lines: {
                        show: true,
                        fill: true,
                        lineWidth: 2,
                        steps: false
                    },
                    points: {
                        show: true,
                        radius: 4.5,
                        symbol: "circle",
                        lineWidth: 3.0
                    }
                },
                legend: {
                    position: "ne",
                    margin: [0, -25],
                    noColumns: 0,
                    labelBoxBorderColor: null,
                    labelFormatter: function(label, series) {
                        return label + '&nbsp;&nbsp;';
                    },
                    width: 40,
                    height: 1
                },
                colors: ['#96CA59', '#3F97EB', '#72c380', '#6f7a8a', '#f7cb38', '#5a8022', '#2c7282'],
                shadowSize: 0,
                tooltip: true,
                tooltipOpts: {
                    content: "%s: %y.0",
                    xDateFormat: "%d/%m",
                    shifts: {
                        x: -30,
                        y: -50
                    },
                    defaultTheme: false
                },
                yaxis: {
                    min: 0
                },
                xaxis: {
                    mode: "time",
                    minTickSize: [1, "day"],
                    timeformat: "%d/%m/%y",
                    min: chart_plot_data[0][0],
                    max: chart_plot_data[max_xaxis-1][0]
                }
            };

            if ($("#chart_plot").length){
                $.plot( $("#chart_plot"),
                    [{
                        label: "Sales Numbers",
                        data: chart_plot_data,
                        lines: {
                            fillColor: "rgba(150, 202, 89, 0.12)"
                        },
                        points: {
                            fillColor: "#fff" }
                    }], chart_plot_settings);
            }
        }

        /* DATERANGEPICKER */
        function init_daterangepicker() {
            if( typeof ($.fn.daterangepicker) === 'undefined'){ return; }
            var cb = function(start, end, label) {
                $('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
            };

            var optionSet = {
                maxDate: new Date(),
                showDropdowns: true,
                showWeekNumbers: true,
                ranges: {
                    'Today': [moment(), moment()],
                    'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                    'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                    'This Month': [moment().startOf('month'), moment().endOf('month')],
                    'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                },
                opens: 'left',
                buttonClasses: ['btn btn-default'],
                applyClass: 'btn-small btn-primary',
                cancelClass: 'btn-small',
                format: 'MM/DD/YYYY',
                separator: ' to ',
                locale: {
                    applyLabel: 'Submit',
                    cancelLabel: 'Clear',
                    fromLabel: 'From',
                    toLabel: 'To',
                    customRangeLabel: 'Custom',
                    daysOfWeek: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'],
                    monthNames: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
                    firstDay: 1
                }
            };

            $('#reportrange span').html(moment().subtract(config.chartPlotData.length-1, 'days').format('MMMM D, YYYY') + ' - ' + moment().format('MMMM D, YYYY'));

            $('#reportrange').daterangepicker(optionSet, cb);
            $('#reportrange').on('show.daterangepicker', function() {
            });
            $('#reportrange').on('hide.daterangepicker', function() {
            });
            $('#reportrange').on('apply.daterangepicker', function(ev, picker) {
                var url = new URL($(location).attr('href'));
                var search_params = url.searchParams;

                search_params.set('reportrange', picker.startDate.format('MMMM D, YYYY') + ' - ' + picker.endDate.format('MMMM D, YYYY'));
                search_params.set('daterangelabel', picker.chosenLabel);
                url.search = search_params.toString();
                var new_url = url.toString();
                window.location.href = new_url;
            });
            $('#reportrange').on('cancel.daterangepicker', function(ev, picker) {
                console.log("cancel event fired");
            });
        }

        function init_charts() {
            if( typeof (Chart) === 'undefined'){ return; }

            Chart.defaults.global.legend = {
                enabled: false
            };

            if ($('#canvas_line').length ){
                var canvas_line_00 = new Chart(document.getElementById("canvas_line"), {
                    type: 'line',
                    data: {
                        labels: ["January", "February", "March", "April", "May", "June", "July"],
                        datasets: [{
                            label: "My First dataset",
                            backgroundColor: "rgba(38, 185, 154, 0.31)",
                            borderColor: "rgba(38, 185, 154, 0.7)",
                            pointBorderColor: "rgba(38, 185, 154, 0.7)",
                            pointBackgroundColor: "rgba(38, 185, 154, 0.7)",
                            pointHoverBackgroundColor: "#fff",
                            pointHoverBorderColor: "rgba(220,220,220,1)",
                            pointBorderWidth: 1,
                            data: [31, 74, 6, 39, 20, 85, 7]
                        }, {
                            label: "My Second dataset",
                            backgroundColor: "rgba(3, 88, 106, 0.3)",
                            borderColor: "rgba(3, 88, 106, 0.70)",
                            pointBorderColor: "rgba(3, 88, 106, 0.70)",
                            pointBackgroundColor: "rgba(3, 88, 106, 0.70)",
                            pointHoverBackgroundColor: "#fff",
                            pointHoverBorderColor: "rgba(151,187,205,1)",
                            pointBorderWidth: 1,
                            data: [82, 23, 66, 9, 99, 4, 2]
                        }]
                    },
                });
            }

            // Doughnut chart
            if ($('#canvasDoughnut').length ){
                var ctx = document.getElementById("canvasDoughnut");
                var data = {
                    labels: [
                        "Male",
                        "Femail"
                    ],
                    datasets: [{
                        data: config.customerGenderData,
                        backgroundColor: [
                            "#455C73",
                            "#9B59B6",
                            "#BDC3C7",
                            "#26B99A",
                            "#3498DB"
                        ],
                        hoverBackgroundColor: [
                            "#34495E",
                            "#B370CF",
                            "#CFD4D8",
                            "#36CAAB",
                            "#49A9EA"
                        ]

                    }]
                };

                var canvasDoughnut = new Chart(ctx, {
                    type: 'doughnut',
                    tooltipFillColor: "rgba(51, 51, 51, 0.55)",
                    data: data
                });
            }
        }

        $(document).ready(function() {
            init_flot_chart();
            init_daterangepicker();
            init_charts();
        });
    }

});